"use strict";var mysafe={asym:{},sym:{},enc:{},hash:{},utils:{},scrypt:{},isReady:function(){return!!(window.crypto||window.msCrypto).subtle},exception:{invalidData:function(e){this.toString=function(){return"invalid data: "+this.message},this.message=e},invalidFormat:function(e){this.toString=function(){return"invalid format: "+this.message},this.message=e},invalidParam:function(e){this.toString=function(){return"invalid parameter: "+this.message},this.message=e}}};mysafe.utils.ascii2Bytes=function(e){for(var t=[],a=0;a<e.length;++a)t.push(e.charCodeAt(a));return new Uint8Array(t)},mysafe.utils.bytes2Ascii=function(e){return String.fromCharCode.apply(null,new Uint8Array(e))},mysafe.utils.bytes2Hex=function(e){if(!e)return null;e=new Uint8Array(e);for(var t=[],a=0;a<e.length;++a){var r=e[a].toString(16);r.length<2&&(r="0"+r),t.push(r)}return t.join("")},mysafe.utils.bytes2HexSep=function(e){if(!e)return null;e=new Uint8Array(e);for(var t=[],a=0;a<e.length;++a){var r=e[a].toString(16);r.length<2&&(r="0"+r),t.push("0x"),t.push(r),a!=e.length-1&&t.push(", ")}return t.join("")},mysafe.utils.hex2Bytes=function(e){if(e.length%2!=0)throw new mysafe.exception.invalidParam("invalid hex");for(var t=new Uint8Array(e.length/2),a=0;a<e.length;a+=2){var r=parseInt(e.substr(a,2),16);if(isNaN(r))throw new mysafe.exception.invalidParam("invalid hex");t[a/2]=r}return t},mysafe.utils.base642Bytes=function(e){var t=new Uint8Array(0);try{for(var a=window.atob(e),r=a.length,t=new Uint8Array(r),s=0;s<r;s++)t[s]=a.charCodeAt(s)}catch(e){throw new mysafe.exception.invalidParam("invalid base64")}return new Uint8Array(t.buffer)},mysafe.utils.bytes2Base64=function(e){return btoa(new Uint8Array(e).reduce((e,t)=>(e.push(String.fromCharCode(t)),e),[]).join(""))},mysafe.utils.string2Utf8=function(e){for(var t=[],a=0;a<e.length;a++){var r=e.charCodeAt(a);r<128?t.push(r):r<2048?t.push(192|r>>6,128|63&r):r<55296||57344<=r?t.push(224|r>>12,128|r>>6&63,128|63&r):(a++,r=65536+((1023&r)<<10|1023&e.charCodeAt(a)),t.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r))}return new Uint8Array(t)},mysafe.utils.utf82string=function(e){for(var t,a,r,s=new Uint8Array(e),n="",y=0;y<s.length;)switch((t=s[y++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:n+=String.fromCharCode(t);break;case 12:case 13:a=s[y++],n+=String.fromCharCode((31&t)<<6|63&a);break;case 14:a=s[y++],r=s[y++],n+=String.fromCharCode((15&t)<<12|(63&a)<<6|(63&r)<<0)}return n},mysafe.utils.uint322array=function(e,t,a=0){return e[a++]=(4278190080&t)>>24,e[a++]=(16711680&t)>>16,e[a++]=(65280&t)>>8,e[a++]=255&t,e},mysafe.utils.concatTypedArrays=function(e,t){var a=new e.constructor(e.length+t.length);return a.set(e,0),a.set(t,e.length),a},mysafe.sym.generateKey=async function(e=256,t="AES-GCM"){return window.crypto.subtle.generateKey({name:t,length:e},!0,["encrypt","decrypt"])},mysafe.sym.generateSalt=function(e=16){e=new Uint8Array(e);return window.crypto.getRandomValues(e),e},mysafe.sym.deriveKey=async function(e,t,a,r="SHA-512"){var s=new ArrayBuffer(0);return await mysafe.hash.hkdfDerivation(e,t,s,a,r)},mysafe.sym.exportKeyBytes=async function(e){return crypto.subtle.exportKey("raw",e)},mysafe.sym.exportKey2Hex=async function(e){e=await mysafe.sym.exportKeyBytes(e);return mysafe.utils.bytes2Hex(e)},mysafe.sym.exportKey2B64=async function(e){e=await mysafe.sym.exportKeyBytes(e);return mysafe.utils.bytes2Base64(e)},mysafe.sym.getKeyFromBytes=async function(e,t="AES-GCM"){return crypto.subtle.importKey("raw",e,t,!0,["encrypt","decrypt"])},mysafe.sym.getKeyFromHex=async function(e){e=mysafe.utils.hex2Bytes(e);return mysafe.sym.getKeyFromBytes(e)},mysafe.sym.getKeyFromB64=async function(e){e=mysafe.utils.base642Bytes(e);return mysafe.sym.getKeyFromBytes(e)},mysafe.sym.ecdhDerivation=async function(e,t,a=528,r="P-521"){return window.crypto.subtle.deriveBits({name:"ECDH",namedCurve:r,public:t},e,a)},mysafe.sym.saltedPartyKey=async function(e,t,a,r=256){t=await mysafe.sym.ecdhDerivation(e,t);return await mysafe.hash.hkdfSha512(t,a,new Uint8Array(0),r)},mysafe.sym.saltedPartyKeyFromEcdh=async function(e,t,a=256){return await mysafe.hash.hkdfSha512(e,t,new Uint8Array(0),a)},mysafe.sym.pbkdf2DerivationKey=async function(e,t,a,r="SHA-256",s="AES-GCM",n=256){e=await window.crypto.subtle.importKey("raw",e,{name:"PBKDF2"},!1,["deriveBits","deriveKey"]);return window.crypto.subtle.deriveKey({name:"PBKDF2",salt:t,iterations:a,hash:r},e,{name:s,length:n},!0,["encrypt","decrypt"])},mysafe.sym.pbkdf2DerivationBits=async function(e,t,a,r,s="SHA-256"){e=await window.crypto.subtle.importKey("raw",e,{name:"PBKDF2"},!1,["deriveBits","deriveKey"]);return await window.crypto.subtle.deriveBits({name:"PBKDF2",salt:t,iterations:a,hash:s},e,r)},mysafe.sym.pbkdf2DerivationBits2=async function(e,t,a,r,s="SHA-256"){var n=new Uint8Array(0),y=new t.constructor(t.length+4);y.set(t,0);for(var i,m,o,c,f=r/8,u=0;n.length<f;){for(u++,cryptocom.misc.uint322array(y,u,t.length),m=await cryptocom.hashes.hmac(e,y,s),i=new Uint8Array(m),o=0;++o<a;)for(m=new Uint8Array(await cryptocom.hashes.hmac(e,m,s)),c=-1;++c<m.length;)i[c]^=m[c];n=cryptocom.misc.concatTypedArrays(n,i)}return n.slice(0,f).buffer},mysafe.scrypt.cpyRegion=function(e,t,a,r){for(var s=e.length-t,n=0;n<s;n++)a[r+n]=0|e[t+n]},mysafe.scrypt.xorRegion=function(e,t,a,r,s){s=s||e.length-t;for(var n=0;n<s;n++)a[r+n]=e[t+n]^a[r+n]|0},mysafe.scrypt.blockMix=function(e){for(var t=e.slice(-16),a=[],r=e.length/16,s=0;s<r;s++)mysafe.scrypt.xorRegion(e,16*s,t,0,16),mysafe.scrypt.salsa20Word(t,8),0==(1&s)?mysafe.scrypt.cpyRegion(t,0,a,8*s):mysafe.scrypt.cpyRegion(t,0,a,8*(s^1+r));return a},mysafe.scrypt.scryptROMix=function(e,t){for(var a=[],r=e.slice(0),s=0;s<t;s++)a.push(r.slice(0)),r=mysafe.scrypt.blockMix(r);for(s=0;s<t;s++){var n=r[r.length-16]&t-1;mysafe.scrypt.xorRegion(a[n],0,r,0),r=mysafe.scrypt.blockMix(r)}return r},mysafe.scrypt.salsa20Word=function(e,t){for(var a=function(e,t){return e<<t|e>>>32-t},r=e.slice(0),s=t;0<s;s-=2)r[4]^=a(r[0]+r[12],7),r[8]^=a(r[4]+r[0],9),r[12]^=a(r[8]+r[4],13),r[0]^=a(r[12]+r[8],18),r[9]^=a(r[5]+r[1],7),r[13]^=a(r[9]+r[5],9),r[1]^=a(r[13]+r[9],13),r[5]^=a(r[1]+r[13],18),r[14]^=a(r[10]+r[6],7),r[2]^=a(r[14]+r[10],9),r[6]^=a(r[2]+r[14],13),r[10]^=a(r[6]+r[2],18),r[3]^=a(r[15]+r[11],7),r[7]^=a(r[3]+r[15],9),r[11]^=a(r[7]+r[3],13),r[15]^=a(r[11]+r[7],18),r[1]^=a(r[0]+r[3],7),r[2]^=a(r[1]+r[0],9),r[3]^=a(r[2]+r[1],13),r[0]^=a(r[3]+r[2],18),r[6]^=a(r[5]+r[4],7),r[7]^=a(r[6]+r[5],9),r[4]^=a(r[7]+r[6],13),r[5]^=a(r[4]+r[7],18),r[11]^=a(r[10]+r[9],7),r[8]^=a(r[11]+r[10],9),r[9]^=a(r[8]+r[11],13),r[10]^=a(r[9]+r[8],18),r[12]^=a(r[15]+r[14],7),r[13]^=a(r[12]+r[15],9),r[14]^=a(r[13]+r[12],13),r[15]^=a(r[14]+r[13],18);for(s=0;s<16;s++)e[s]=r[s]+e[s]},mysafe.scrypt.scryptBits=async function(e,t,a,r,s,n,y="SHA-256"){for(var r=await mysafe.sym.pbkdf2DerivationBits2(e,t,1,128*s*r*8,y),i=new Uint32Array(r),m=i.length/s,o=0;o<s;o++){var c=i.slice(o*m,(o+1)*m);mysafe.scrypt.cpyRegion(mysafe.scrypt.scryptROMix(c,a),0,i,o*m)}return mysafe.sym.pbkdf2DerivationBits2(e,i,1,n,y)},mysafe.asym.generateECDSA=async function(e="P-521"){return await window.crypto.subtle.generateKey({name:"ECDSA",namedCurve:e},!0,["sign","verify"])},mysafe.asym.exportPublicKey2Bytes=async function(e){return await window.crypto.subtle.exportKey("spki","public"==e.type?e:e.publicKey)},mysafe.asym.exportPublicKey2Hex=async function(e){e=await mysafe.asym.exportPublicKey2Bytes(e);return mysafe.utils.bytes2Hex(e)},mysafe.asym.exportPublicKey2B64=async function(e){e=await mysafe.asym.exportPublicKey2Bytes(e);return mysafe.utils.bytes2Base64(e)},mysafe.asym.exportPrivateKey2Bytes=async function(e){return await window.crypto.subtle.exportKey("pkcs8","private"==e.type?e:e.privateKey)},mysafe.asym.exportPrivateKey2Hex=async function(e){e=await mysafe.asym.exportPrivateKey2Bytes(e);return mysafe.utils.bytes2Hex(e)},mysafe.asym.exportPrivateKey2B64=async function(e){e=await mysafe.asym.exportPrivateKey2Bytes(e);return mysafe.utils.bytes2Base64(e)},mysafe.asym.importPrivateFromBytes=async function(e,t="P-521"){return crypto.subtle.importKey("pkcs8",e,{name:"ECDSA",namedCurve:t},!0,["sign"])},mysafe.asym.importPrivateFromHex=async function(e,t="P-521"){e=mysafe.utils.hex2Bytes(e);return mysafe.asym.importPrivateFromBytes(e,t)},mysafe.asym.importPrivateFromB64=async function(e,t="P-521"){e=mysafe.utils.base642Bytes(e);return mysafe.asym.importPrivateFromBytes(e,t)},mysafe.asym.importPublicFromBytes=async function(e,t="P-521"){return crypto.subtle.importKey("spki",e,{name:"ECDSA",namedCurve:t},!0,["verify"])},mysafe.asym.importPublicFromHex=async function(e,t="P-521"){e=mysafe.utils.hex2Bytes(e);return mysafe.asym.importPublicFromBytes(e,t)},mysafe.asym.importPublicFromB64=async function(e,t="P-521"){e=mysafe.utils.base642Bytes(e);return mysafe.asym.importPublicFromBytes(e,t)},mysafe.asym.importPrivateFromBytesECDH=async function(e,t="P-521"){return crypto.subtle.importKey("pkcs8",e,{name:"ECDH",namedCurve:t},!0,["deriveKey","deriveBits"])},mysafe.asym.importPrivateFromHexECDH=async function(e,t="P-521"){e=mysafe.utils.hex2Bytes(e);return mysafe.asym.importPrivateFromBytesECDH(e,t)},mysafe.asym.importPrivateFromB64ECDH=async function(e,t="P-521"){e=mysafe.utils.base642Bytes(e);return mysafe.asym.importPrivateFromBytesECDH(e,t)},mysafe.asym.importPublicFromBytesECDH=async function(e,t="P-521"){return crypto.subtle.importKey("spki",e,{name:"ECDH",namedCurve:t},!0,[])},mysafe.asym.importPublicFromHexECDH=async function(e,t="P-521"){e=mysafe.utils.hex2Bytes(e);return mysafe.asym.importPublicFromBytesECDH(e,t)},mysafe.asym.importPublicFromB64ECDH=async function(e,t="P-521"){e=mysafe.utils.base642Bytes(e);return mysafe.asym.importPublicFromBytesECDH(e,t)},mysafe.asym.privateDSA2ECD=async function(e,t="P-521"){e=await mysafe.asym.exportPrivateKey2Bytes(e);return mysafe.asym.importPrivateFromBytesECDH(e,t)},mysafe.asym.publicDSA2ECD=async function(e,t="P-521"){e=await mysafe.asym.exportPublicKey2Bytes(e);return mysafe.asym.importPublicFromBytesECDH(e,t)},mysafe.hash.sha512=async function(e){return await crypto.subtle.digest("SHA-512",e)},mysafe.hash.sha256=async function(e){return await crypto.subtle.digest("SHA-256",e)},mysafe.hash.sha1=async function(e){return await crypto.subtle.digest("SHA-1",e)},mysafe.hash.hmac=async function(e,t,a){a={name:"HMAC",hash:a},e=await crypto.subtle.importKey("raw",e,a,!1,["sign","verify"]);return await crypto.subtle.sign(a.name,e,t)},mysafe.hash.hmac512=async function(e,t){return mysafe.hash.hmac(e,t,"SHA-512")},mysafe.hash.hmac256=async function(e,t){return mysafe.hash.hmac(e,t,"SHA-256")},mysafe.hash.hmac1=async function(e,t){return mysafe.hash.hmac(e,t,"SHA-1")},mysafe.hash.hkdfDerivation=async function(e,t,a,r,s){e=await crypto.subtle.importKey("raw",e,{name:"HKDF"},!1,["deriveKey","deriveBits"]);return await crypto.subtle.deriveBits({name:"HKDF",info:a,salt:t,hash:s},e,r)},mysafe.hash.hkdfSha256=async function(e,t,a,r){return mysafe.hash.hkdfDerivation(e,t,a,r,"SHA-256")},mysafe.hash.hkdfSha512=async function(e,t,a,r){return mysafe.hash.hkdfDerivation(e,t,a,r,"SHA-512")},mysafe.enc.getTag=function(e,t){return void 0===t&&(t=16),e.slice(e.byteLength-(t+7>>3))},mysafe.enc.encryptData=async function(e,t,a=12,r="AES-GCM"){a=window.crypto.getRandomValues(new Uint8Array(a)),t=await window.crypto.subtle.encrypt({name:r,iv:a},e,t),t=new Uint8Array(t);const s=new Uint8Array(a.length+t.length);return s.set(a),s.set(t,a.length),s},mysafe.enc.decryptData=async function(e,t,a=12,r="AES-GCM"){try{var s=t.slice(0,a),n=t.slice(a,t.length),y=await window.crypto.subtle.decrypt({name:r,iv:s},e,n)}catch(e){throw new mysafe.exception.invalidData("Unable to decrypt:",e.message)}return y},cryptocom.parameters.aesAlg="AES-GCM",cryptocom.parameters.aesKeyLen=256,cryptocom.parameters.encIVLen=12,cryptocom.parameters.hmacAlg="SHA-512",cryptocom.parameters.ecCurveName="P-521",cryptocom.parameters.hkdfAlg="SHA-512",cryptocom.parameters.cost_factor_N=1024,cryptocom.parameters.block_size_factor_r=8,cryptocom.parameters.parallelism_factor=1,cryptocom.parameters.salt_size=128,cryptocom.parameters.meta_info="MetaKeyPairKeyDerivation";